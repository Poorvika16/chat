<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Document Assistant</title>

<style>
body{
    font-family: Arial, sans-serif;
    background:#f4f6f9;
    margin:0;
    display:flex;
    flex-direction:column;
    height:100vh;
}

header{
    background:#4CAF50;
    color:white;
    padding:15px;
    text-align:center;
    font-size:22px;
    font-weight:bold;
}

#chatbox{
    flex:1;
    overflow-y:auto;
    padding:20px;
    background:#e9ecef;
}

.message{
    padding:12px;
    border-radius:10px;
    margin:12px 0;
    max-width:75%;
}

.user{
    background:#4CAF50;
    color:white;
    margin-left:auto;
}

.bot{
    background:white;
    box-shadow:0 2px 6px rgba(0,0,0,0.1);
    margin-right:auto;
}

.bot img{
    max-width:500px;
    margin-top:12px;
    border:1px solid #ddd;
    border-radius:6px;
    display:block;
}

form{
    display:flex;
    padding:10px;
    background:white;
    border-top:1px solid #ddd;
}

input{
    flex:1;
    padding:10px;
    border:1px solid #ccc;
    border-radius:6px;
}

button{
    padding:10px 20px;
    background:#4CAF50;
    color:white;
    border:none;
    margin-left:10px;
    border-radius:6px;
    cursor:pointer;
}

.loading{
    font-style:italic;
    color:#777;
}
</style>
</head>

<body>

<header>Document Assistant</header>

<div id="chatbox"></div>

<form id="form">
    <input id="query" placeholder="Ask question..." required>
    <button type="submit">Send</button>
</form>

<script>
const form = document.getElementById("form");
const chat = document.getElementById("chatbox");

form.addEventListener("submit", async (e)=>{
    e.preventDefault();

    const input = document.getElementById("query");
    const q = input.value.trim();
    if(!q) return;

    chat.innerHTML += `<div class="message user">${q}</div>`;
    chat.scrollTop = chat.scrollHeight;

    input.value = "";

    const loadingId = "loading_" + Date.now();
    chat.innerHTML += `<div id="${loadingId}" class="message bot loading">Generating answer...</div>`;

    try{

        const res = await fetch("/ask",{
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({question:q})
        });

        const data = await res.json();

        document.getElementById(loadingId).remove();

        let html = `<div class="message bot"><p>${data.answer}</p>`;

        if(data.images && Array.isArray(data.images)){
            data.images.forEach(img=>{
                html += `<img src="${img}">`;
            });
        }

        html += `</div>`;

        chat.innerHTML += html;
        chat.scrollTop = chat.scrollHeight;

    }
    catch(err){
        console.error(err);
        document.getElementById(loadingId).remove();
        chat.innerHTML += `<div class="message bot">Server error</div>`;
    }

});
</script>

</body>
</html>
